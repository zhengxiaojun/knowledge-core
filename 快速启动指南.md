# 快速启动指南

## 1. 安装依赖

```bash
cd D:\Projects\Python\vx-knowledge-core
pip install -r requirements.txt
```

## 2. 配置环境变量

创建 `.env` 文件：

```env
# 应用配置
PROJECT_NAME=AI测试用例自动生成系统
PROJECT_VERSION=1.0.0
APP_HOST=0.0.0.0
APP_PORT=8000

# 数据库配置
SQLALCHEMY_DATABASE_URI=mysql+pymysql://test_user:test_password@localhost:3306/vx_knowledge

# Milvus 配置
MILVUS_URI=http://localhost:19530
MILVUS_TOKEN=
MILVUS_COLLECTION_NAME=test_knowledge_vectors
EMBEDDING_DIM=1536

# Neo4j 配置
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=neo4j_password

# OpenAI 配置
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4-turbo
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# LLM 参数
LLM_TEMPERATURE=0.7
LLM_MAX_TOKENS=2000
```

## 3. 启动数据库服务

### MySQL
```bash
# 使用 Docker
docker run -d \
  --name mysql-vx \
  -e MYSQL_ROOT_PASSWORD=rootpass \
  -e MYSQL_DATABASE=vx_knowledge \
  -e MYSQL_USER=test_user \
  -e MYSQL_PASSWORD=test_password \
  -p 3306:3306 \
  mysql:8.0
```

### Neo4j
```bash
# 使用 Docker
docker run -d \
  --name neo4j-vx \
  -e NEO4J_AUTH=neo4j/neo4j_password \
  -p 7474:7474 \
  -p 7687:7687 \
  neo4j:5.15
```

### Milvus
```bash
# 使用 Docker Compose（推荐）
# 下载 Milvus docker-compose.yml
wget https://github.com/milvus-io/milvus/releases/download/v2.4.9/milvus-standalone-docker-compose.yml -O docker-compose-milvus.yml
docker-compose -f docker-compose-milvus.yml up -d
```

## 4. 初始化数据库

```bash
python -c "from app.models.sql_models import init_db; init_db()"
```

或者直接启动应用（会自动初始化）：

```bash
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## 5. 验证服务

### 访问 API 文档
打开浏览器访问：http://localhost:8000/docs

### 测试基本接口

```bash
# 测试根路径
curl http://localhost:8000/

# 上传需求文档（文本格式）
curl -X POST "http://localhost:8000/api/requirements/upload" \
  -F "project_id=test_project" \
  -F "input_type=text" \
  -F "files=@test_requirement.txt"

# 查询需求列表
curl http://localhost:8000/api/requirements
```

## 6. 完整测试流程

### Step 1: 上传需求文档
```bash
curl -X POST "http://localhost:8000/api/requirements/upload" \
  -H "Content-Type: multipart/form-data" \
  -F "project_id=demo" \
  -F "input_type=text" \
  -F "files=@requirement.txt"

# 返回: {"code": 0, "message": "success", "data": {"requirement_id": "1", "raw_chunks": 1}}
```

### Step 2: 分析测试意图
```bash
curl -X POST "http://localhost:8000/api/requirements/1/intent"

# 返回测试意图列表
```

### Step 3: 生成测试点
```bash
curl -X POST "http://localhost:8000/api/testpoints/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "requirement_id": 1
  }'

# 返回测试点列表
```

### Step 4: 批量生成测试用例
```bash
curl -X POST "http://localhost:8000/api/testcases/batch-generate" \
  -H "Content-Type: application/json" \
  -d '{
    "requirement_id": 1
  }'

# 返回: {"code": 0, "data": {"task_id": "1", "status": "INIT"}}
```

### Step 5: 查询生成任务状态
```bash
curl http://localhost:8000/api/tasks/1

# 返回任务状态和生成的测试用例
```

### Step 6: 确认测试用例
```bash
curl -X POST "http://localhost:8000/api/testcases/confirm" \
  -H "Content-Type: application/json" \
  -d '{
    "case_ids": [1, 2, 3]
  }'
```

### Step 7: 导出测试用例
```bash
curl -X POST "http://localhost:8000/api/testcases/export" \
  -H "Content-Type: application/json" \
  -d '{
    "case_ids": [1, 2, 3],
    "format": "json"
  }'
```

## 7. 常见问题

### Q1: 导入模块错误
**问题**: `ModuleNotFoundError: No module named 'xxx'`

**解决**: 
```bash
pip install -r requirements.txt
```

### Q2: 数据库连接失败
**问题**: `Can't connect to MySQL server`

**解决**: 
- 检查 MySQL 服务是否启动
- 检查 `.env` 中的数据库连接配置
- 确认数据库用户名和密码正确

### Q3: OpenAI API 调用失败
**问题**: `Error code: 401 - Incorrect API key`

**解决**: 
- 检查 `.env` 中的 `OPENAI_API_KEY` 是否正确
- 确认 API Key 有足够的余额
- 检查网络连接（可能需要代理）

### Q4: Milvus 连接失败
**问题**: `Failed to connect to Milvus`

**解决**: 
- 确认 Milvus 服务已启动
- 检查端口 19530 是否可访问
- 查看 Milvus 日志：`docker logs milvus-standalone`

### Q5: Neo4j 连接失败
**问题**: `Unable to connect to Neo4j`

**解决**: 
- 确认 Neo4j 服务已启动
- 检查端口 7687 是否可访问
- 验证用户名密码是否正确

## 8. 开发工具

### 推荐的 API 测试工具
- **Postman**: 图形化 API 测试工具
- **Swagger UI**: 访问 http://localhost:8000/docs
- **curl**: 命令行工具

### 推荐的数据库管理工具
- **DBeaver**: 通用数据库客户端（支持 MySQL）
- **Neo4j Browser**: 访问 http://localhost:7474
- **Attu**: Milvus 可视化管理工具

## 9. 监控和调试

### 查看应用日志
```bash
# 如果使用 uvicorn 运行
# 日志会直接输出到控制台
```

### 查看数据库状态
```bash
# MySQL
docker exec -it mysql-vx mysql -u test_user -p vx_knowledge

# Neo4j
# 访问 http://localhost:7474

# Milvus
docker logs milvus-standalone
```

## 10. 停止服务

```bash
# 停止应用
# Ctrl+C 在运行 uvicorn 的终端

# 停止数据库容器
docker stop mysql-vx neo4j-vx milvus-standalone

# 移除容器（可选）
docker rm mysql-vx neo4j-vx milvus-standalone
```

## 11. 生产部署建议

1. 使用生产级别的 WSGI 服务器（如 Gunicorn）
2. 配置反向代理（如 Nginx）
3. 启用 HTTPS
4. 配置日志收集和监控
5. 设置自动备份
6. 使用环境变量而不是 .env 文件
7. 配置资源限制和自动扩展

## 12. 性能调优

1. 调整数据库连接池大小
2. 配置 Milvus 索引参数（HNSW）
3. 启用 Redis 缓存热点数据
4. 使用异步任务队列（Celery）处理长时间操作
5. 优化 LLM Prompt 减少 Token 消耗
