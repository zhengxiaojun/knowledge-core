version: "3.8"

services:
  mysql:
    image: mysql:8.0
    container_name: vx_mysql
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: vx_knowledge
      MYSQL_USER: test_user
      MYSQL_PASSWORD: test_password
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 10

  milvus:
    image: milvusdb/milvus:v2.4.9-latest
    container_name: vx_milvus
    ports:
      - "19530:19530" # gRPC
      - "9091:9091"   # HTTP
    volumes:
      - milvus_data:/milvus/data
    environment:
      ETCD_USE_EMBED: "true"
      ETCD_DATA_DIR: "/var/lib/milvus/etcd"
      COMMON_STORAGETYPE: "local"

  neo4j:
    image: neo4j:5
    container_name: vx_neo4j
    environment:
      NEO4J_AUTH: neo4j/neo4j_password
      NEO4J_PLUGINS: '["apoc"]'
    ports:
      - "7474:7474" # HTTP
      - "7687:7687" # Bolt
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs

volumes:
  mysql_data:
  milvus_data:
  neo4j_data:
  neo4j_logs:
